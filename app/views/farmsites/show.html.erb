<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.2.0/jquery.rateyo.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.2.0/jquery.rateyo.min.js"></script>


<!-- left -->                      
<div class="row">
  <div class="col-sm-1"></div>
  <!-- first --> 
  <div class="col-sm-5">

    <div class="panel panel-default">
      <div class="panel-thumbnail"><%= image_tag @farmsite.avatar.url,class: "img-responsive",style: "height:250px;"%></div>
    </div>

<!-- second --> 

    <div class="panel panel-default">
     <div class="panel-heading">Produces (click on produce's name)
         <% if user_signed_in? and @farmsite and @farmsite.farmer == current_user.meta and  @farmsite.present?  %>
              <%= link_to 'Add Produce', new_produce_path(farmsite_id: @farmsite.id) , class: "btn btn-success btn-sm pull-right" , data: {turbolinks: false}, remote: true %>
          <%end%>
     </div>
      <div class="panel-body">
    
        <!--Carousel -->
        <% if @farmsite.produces.present? %>
        <div id="myCarousel" class="carousel slide" data-ride="carousel">

          <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#myCarousel" data-slide-to="1"></li>
          </ol>

          <div class="carousel-inner" role="listbox">
            <% @farmsite.produces.each_with_index do |produce,index| %>
              <div class="item <%= 'active' if index == 0 %>">
                <%= image_tag produce.avatar.url,class: "img-responsive",style: "height:300px;"%>
                <div class="carousel-caption">
                 <h1><a href="<%= produce_path(id: produce.id) %>" style="color:white"><%= produce.producename %></h1>
               </div>

             </div>
           <% end %>
        
        </div>

        <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>

      <% else %>
        <div align="center">
          No Produces Available. 
        </div>
       <% end %>
      <!--Carousel -->



        </div>
      </div>

    <!-- third --> 
    <div class="panel panel-default">
     <div class="panel-heading"></a>Review</div>
     <div class="panel-body">
       

       
       <form>
        <div class="input-group">
          <div class="input-group-btn">
            
          </div>
          <input type="text" class="form-control" placeholder="Add a comment..">
        </div>
      </form>
<hr>
<div id="average"></div>




<span>based on <%= @farmsite.reviews.count %> reviews</span>

<% @reviews = @farmsite.reviews %>

<%@reviews.each do | review| %>

  <% @review = review %>
  <br>
  <%= render "reviews/show" , :review => @review%>
<%end%>
<br>
<%= link_to "Add Review", new_farmsite_review_path(@farmsite) %></br>
    </div>
  </div>
  <!-- end left --> 
</div>
<% @review_average = @reviews.count != 0 ? (@reviews.sum(:rating) / @reviews.count) : 0 %>




<!-- right --> 
<div class="row">
  <div class="col-sm-6"></div>

  <!-- first --> 
  <div class="col-sm-5">
    <div class="panel panel-default">
      <div class="panel-heading"><center><h4><%= @farmsite.farmsitename %></h4></center></div>
      <div class="panel-body">
        <table class="table">
          <tr><th> <strong>Size: </strong></th><td><%= @farmsite.farmsitesize %> acres</td></tr>
          <tr><th><strong>Address: </strong></th><td><%= @farmsite.farmsiteaddress %></td></tr>
          <tr><th><strong>Owner: </strong></th><td><%= @farmsite.farmsiteownername %></td></tr>
          <tr><th><strong>Company: </strong></th><td><a href="<%= user_views_profile_path(id: @farmsite.farmer.user.id)%>"><%= @farmsite.farmer.user.meta.company_name %></td></tr>
          <tr><th><strong>Contact: </strong></th><td><%= @farmsite.farmer.user.meta.company_phone %></td></tr>
          <tr><th><strong>Description: </strong></th><td><%= @farmsite.farmsitedescription %></td></tr>
          <br>
        </table>
<hr>
        <% if user_signed_in? %>
            <% if current_user.meta_type == "Farmer" and @farmsite.farmer == current_user.meta %>
            <div align="right">
              <%= link_to edit_farmsite_path(@farmsite)   , class: "btn btn-primary btn-sm", remote: true  do %><i class= "glyphicon glyphicon-edit" > </i> Edit<% end %>

              <%= link_to  @farmsite, method: :delete, data: { confirm: 'Are you sure?' } , class: "btn btn-danger btn-sm" do %> <i class= "glyphicon glyphicon-remove">  </i> Remove<% end %>
              </div>
            <%end%>
          <%end%>

      </div>
    </div>

    

      <!-- end right --> 
  
  <!-- third --> 
    <div class="panel panel-default">
      <div class="panel-heading">Farm Location</div>
      <div class="panel-body">
       
 
    <div style='width: 100%;'>
       <div style='length: 100%;'>
      <div id="multi_markers" style=' height: 400px;'></div>
    </div></center>

    <script >
      var handler = Gmaps.build('Google');
      handler.buildMap({ internal: {id: 'multi_markers'} } , function() {
          var marker = handler.addMarker({lat: <%= @farmsite.latitude %>, lng: <%= @farmsite.longitude %>});
          // handler.bounds.extendWith(markers);
          // handler.fitMapToBounds();
          handler.map.centerOn(marker);
        
      } )
    </script>
      </div>
    </div>


  </div>



</div></div></a></div></div></div></div></div>


<script>
/* Javascript */
 
$(function () {
 
  $("#average").rateYo({
    rating: "<%=@review_average%>",
    readOnly: true
  });
});
</script>